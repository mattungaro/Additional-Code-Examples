

These are my results of the test related to the Data Engineer Position.

## 1
What are the GeoType types in the data set? How many rows of data for each GeoType? Choose a GeoType of data you would like to use for further exploration (state or county) and create a filtered dataset of that GeoType.

```{r}
library(tidyverse)
library(sf)
library(reshape2)
library(tidycensus)
Yale_Climate_OP <- read_csv("C:\\Users\\Owner\\Documents\\Career Resources\\Portfolio\\R Code Extra Examples\\YCOM_2016_Data.csv")
unique(Yale_Climate_OP$GeoType)
Yale_Climate_OP %>% group_by(GeoType) %>% summarize(count=n()) %>% print()
state_climate_op <- Yale_Climate_OP %>% filter(GeoType == "State")

```
There are national, state, county, cd113, and CBSA types. 

There are 916 CBSAs, 435 cd113s, 3142 counties, 1 national type, and 51 states.

I created a filtered dataset of states.


## 2
Summarize the filtered data from question 1 and extract 1-2 insight(s) from the data. Example questions: Which state/county has the highest population? Top 3 states/counties with highest support rate of “Global warming is happening” (column “happening”).

Which state is the most worried about climate change? Which state has the lowest percentage of people worried about climate change? What is the average level of concern per state?

What are the top three states that are least worried about the impact on future generations?

```{r}
summary(state_climate_op$worried)
state_climate_op %>% filter(worried > 74)
state_climate_op %>% filter(worried < 46)

state_climate_op %>% arrange(desc(futuregenOppose)) %>% select(futuregenOppose, GeoName)
```
The District of Columbia is the most worried about climate change (74.29%). West Virginia has the lowest percentage of people worried about climate change (45.32%). The average percentage of people worried about climate change is 56.13%.

Utah, Wyoming, and West Virginia are least concerned with the impact on future generations, with 30.82%, 29.32%, and 27.59% respectively stating that they have little or no concern that future generations will be impacted.

## 3
Wide data to long data. In the data, for each survey question, we split the rate (percent of population) into two columns by people’s opinion of the question. (Ex: discuss and discussOppose.) We would like to format the data into a long table. To do so, please first select all the id columns and a question column pair (ex:”discuss” and “discussOppose”) as the new dataset to work with. Create a new column named “opinion”. Fill this column with either ‘support’ or ‘oppose’ to indicate people’s opinion of the survey question. And a column named as the selected question with the respective percent of population value. Save the result dataframe as a csv file.

```{r}
long <- state_climate_op %>% select(GeoType, GEOID, GeoName, TotalPop, harmUS, harmUSOppose)

long_test <- long %>% melt( id.vars = c("GeoType", "GEOID", "GeoName", "TotalPop"), variable.name = "old_columns")

long_test$opinion <- ifelse((long_test$old_columns == "harmUS"), "Support", "Oppose")

long_test_final <- long_test %>% select(GeoType, GEOID, GeoName, TotalPop, opinion, discuss = value) %>% arrange((GeoName))

#write_csv(long_test_final, "C:\\Users\\Owner\\Desktop\\YCOM_2016_Data_2.csv")

```
## 4. 
The data in their current form do not include any actual geographic information. Instead, they only have the state and county names. To fix this your objective is to find open-source geospatial data for the GeoType you choose in question 1 and merge them into the data we have
```{r}
census_api_key('39e37ca2bcc68f7fb19aec0b37bea59d93ce7337', overwrite = TRUE)
states <- tibble(tidycensus::state_laea)
state_climate_op %>% arrange(GeoName)
states$GEOID <- as.numeric(states$GEOID)
states_with_geom <- full_join(states, state_climate_op, by = "GEOID")
#write_csv(states_with_geom, "C:\\Users\\Owner\\Desktop\\YCOM_2016_Data_with_geometry.csv")
```

Question 4 complete.

#5. 

Choose any survey question you prefer (ex: discuss, CO2limits, etc) and visualize the data with a heatmap.

```{r}
ggplot(states_with_geom$geometry) + 
  geom_sf(aes(fill = states_with_geom$CO2limits)) + 
  coord_sf() + scale_fill_viridis_c(option = "plasma", direction = -1) + ggtitle("Percentage of Population that Prefers CO2 Limits")+ labs(fill = "% of Population")

```


